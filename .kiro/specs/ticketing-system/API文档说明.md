# 演出票务系统API文档说明

## 文档位置

完整的OpenAPI 3.0格式API文档位于：
```
.kiro/specs/ticketing-system/apifox-openapi-complete.yaml
```

## 如何导入Apifox

1. 打开Apifox应用
2. 点击左上角"导入"按钮
3. 选择"OpenAPI/Swagger"格式
4. 选择"从文件导入"
5. 选择 `apifox-openapi-complete.yaml` 文件
6. 点击"确认导入"

## API文档内容概览

本文档包含了演出票务系统的所有核心接口，共计**80+个API接口**，涵盖以下模块：

### 1. 用户服务（10个接口）
- 发送短信验证码
- 用户注册/登录
- 微信登录
- 获取/更新用户信息
- 收货地址管理
- 实名信息管理

### 2. 项目服务（15个接口）
- 获取城市/类目列表
- 项目列表查询（支持筛选、分页、排序）
- 项目详情查看
- 场次管理
- 票档管理
- 想看功能

### 3. 订单服务（10个接口）
- 创建订单
- 订单列表/详情查询
- 取消订单
- 退款申请/查询
- 电子票查看（票夹）

### 4. 支付服务（4个接口）
- 创建支付订单
- 查询支付状态
- 支付宝/微信支付回调

### 5. 库存服务（5个接口）
- 检查库存可用性
- 座位分配
- 座位锁定/释放

### 6. 营销服务（4个接口）
- 获取可领取优惠券
- 领取优惠券
- 用户优惠券列表
- 获取适用促销活动

### 7. 搜索服务（3个接口）
- 项目搜索
- 搜索建议
- 热门搜索词

### 8. B端管理（10个接口）
- 商家首页看板
- 商家项目管理
- 商家订单管理
- 订单导出
- 后台售票
- 退款审核
- 结算管理
- 提现申请

### 9. 运营后台（10个接口）
- 用户管理（查询、冻结）
- 商家管理（查询、审核）
- 优惠券管理
- Banner管理
- 城市管理
- 类目管理

### 10. 总代票务（8个接口）
- 数据大屏
- 座位图管理
- 座位详情查看
- 批量锁定座位
- 打印纸质票
- 配票管理
- 检票统计

## 接口特性

### 认证方式
- 使用JWT Bearer Token认证
- 部分公开接口无需认证（如城市列表、项目列表、搜索等）

### 统一响应格式
所有接口返回统一的响应格式：
```json
{
  "code": 1000,
  "message": "操作成功",
  "timestamp": 1700000000000,
  "data": {}
}
```

### 错误码说明
- `1000`: 操作成功
- `1001`: 参数错误
- `1002`: 未授权
- `1003`: 禁止访问
- `1004`: 资源不存在
- `1005`: 服务器错误
- `2xxx`: 用户相关错误
- `3xxx`: 项目相关错误
- `4xxx`: 订单相关错误
- `5xxx`: 库存相关错误
- `6xxx`: 支付相关错误

### 分页参数
列表查询接口统一使用以下分页参数：
- `page`: 页码，默认1
- `size`: 每页数量，默认20

### 日期时间格式
- 日期：`YYYY-MM-DD`
- 日期时间：`YYYY-MM-DDTHH:mm:ss`

## 环境配置

文档中定义了三个服务器环境：
1. **生产环境**: `https://api.ticketing.com`
2. **测试环境**: `https://test-api.ticketing.com`
3. **本地开发**: `http://localhost:8080`

导入后可在Apifox中切换不同环境进行测试。

## 数据模型

文档包含了完整的数据模型定义（Schemas），包括：
- 用户相关：User, Address, RealNameInfo
- 项目相关：Event, Session, TicketTier, Seat, Venue
- 订单相关：Order, OrderItem, Refund, Ticket
- 支付相关：Payment
- 营销相关：Coupon, UserCoupon, Promotion, Banner
- 其他：City, Category, SeatMap等

所有模型都包含了详细的字段说明、类型定义和示例值。

## 使用建议

1. **接口测试顺序**：
   - 先测试用户注册/登录获取Token
   - 使用Token测试需要认证的接口
   - 按业务流程测试（浏览项目 → 选票 → 下单 → 支付）

2. **环境变量**：
   - 在Apifox中设置环境变量存储Token
   - 设置baseUrl变量方便切换环境

3. **Mock数据**：
   - 文档中包含了示例数据
   - 可在Apifox中启用Mock服务进行前端开发

4. **接口文档维护**：
   - 后端开发时保持文档同步更新
   - 使用Apifox的版本管理功能

## 技术支持

如有问题，请联系：
- Email: api@ticketing.com
- 文档版本: 1.0.0
- 最后更新: 2024-01-01
