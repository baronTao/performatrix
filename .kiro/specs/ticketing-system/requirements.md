# 演出票务系统需求文档

## 简介

本系统是一个综合性的演出票务电商平台，包含C端移动应用（Android/iOS，使用uni-app框架）和B端商家管理后台（Vue框架）。系统支持高并发抢票场景，提供从演出信息展示、在线购票、订单管理到后台运营的完整解决方案。

## 术语表

- **票务系统 (Ticketing System)**: 整个演出票务管理和销售平台
- **C端用户 (End User)**: 购买演出票的消费者
- **B端商家 (Merchant)**: 演出项目的供应商或票务代理商
- **项目 (Event)**: 一个演出活动
- **场次 (Session)**: 项目的具体演出时间场次
- **票档 (Ticket Tier)**: 不同价位的票种
- **实名制 (Real-name Registration)**: 购票时需要提供真实身份信息
- **想看 (Wishlist)**: 用户收藏感兴趣的演出项目
- **缺货登记 (Out-of-stock Registration)**: 票售罄后用户登记补货通知
- **频道 (Channel)**: 演出类目分类，如演唱会、话剧、体育等
- **金刚位 (Quick Entry)**: 首页频道快捷入口图标区域
- **观演人 (Attendee)**: 实际观看演出的人员信息
- **票夹 (Ticket Wallet)**: 用户存放电子票的功能模块
- **黑名单 (Blacklist)**: 被禁止购票的用户名单

---

## 一、电商C端需求（uni-app移动端）

### 需求 1: 城市列表页和城市切换

**用户故事:** 作为C端用户，我希望能够选择和切换城市，以便查看我所在城市的演出信息

#### 验收标准

1. THE 票务系统 SHALL 提供城市列表页，展示当前城市、定位城市和所有城市列表
2. THE 票务系统 SHALL 默认定位当前城市并在城市列表页标识
3. THE 票务系统 SHALL 支持根据首字母快速锚点定位相关城市内容
4. THE 票务系统 SHALL 将城市作为所有数据的数据隔离标准
5. WHEN 用户切换城市，THE 票务系统 SHALL 联动更新所有数据及功能，仅展示选定城市的演出信息
6. THE 票务系统 SHALL 保存用户的城市选择偏好到本地存储

**城市配置字段（B端管理）：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 城市名称 | 文本 | 是 | 城市名称 |
| 城市编码 | 文本 | 是 | 城市唯一编码 |
| 首字母 | 文本 | 是 | 城市名称首字母，用于快速定位 |
| 是否热门 | 开关 | 是 | 是否为热门城市 |
| 排序权重 | 数字 | 是 | 热门城市排序 |
| 状态 | 下拉选择 | 是 | 启用/禁用 |

---

### 需求 2: 首页

**用户故事:** 作为C端用户，我希望在首页快速浏览热门演出和活动，以便发现感兴趣的内容

#### 验收标准

1. THE 票务系统 SHALL 在首页提供搜索按钮
2. WHEN 用户点击搜索按钮，THE 票务系统 SHALL 跳转至单独的搜索页面
3. THE 票务系统 SHALL 在首页展示Banner轮播图
4. THE 票务系统 SHALL 支持Banner自动循环播放和手动切换
5. WHEN 用户点击Banner，THE 票务系统 SHALL 跳转至相关详情页
6. THE 票务系统 SHALL 在首页展示频道金刚位
7. WHEN 用户点击频道金刚位，THE 票务系统 SHALL 跳转至对应频道列表页
8. THE 票务系统 SHALL 在金刚位下面展示项目列表，根据项目时间进行排序
9. THE 票务系统 SHALL 支持项目列表下拉自动刷新展示
10. THE 票务系统 SHALL 根据用户选定的城市展示对应城市的首页内容

**频道（金刚位）配置字段（B端管理）：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 频道名称 | 文本 | 是 | 频道显示名称，如演唱会、话剧等 |
| 频道编码 | 文本 | 是 | 频道唯一编码 |
| 频道图标 | 图片上传 | 是 | 金刚位展示图标 |
| 排序权重 | 数字 | 是 | 显示顺序，数字越大越靠前 |
| 状态 | 下拉选择 | 是 | 启用/禁用 |

---

### 需求 3: 搜索页面

**用户故事:** 作为C端用户，我希望搜索演出项目，以便快速找到我想看的演出

#### 验收标准

1. THE 票务系统 SHALL 提供独立的搜索页面，包含搜索输入框
2. THE 票务系统 SHALL 在搜索结果列表展示项目信息，包括图片、名称、日期、周几、时间、城市、剧院、价格
3. WHEN 用户点击搜索结果，THE 票务系统 SHALL 跳转至项目详情页
4. THE 票务系统 SHALL 根据用户选定的城市过滤搜索结果

---

### 需求 4: 频道列表页

**用户故事:** 作为C端用户，我希望按类目浏览演出列表，以便找到特定类型的演出

#### 验收标准

1. THE 票务系统 SHALL 在频道列表页顶部展示频道导航
2. THE 票务系统 SHALL 在频道导航区域提供搜索按钮
3. WHEN 用户点击搜索按钮，THE 票务系统 SHALL 跳转至搜索页面（与首页搜索按钮跳转页面一致）
4. THE 票务系统 SHALL 在导航下面展示项目列表
5. THE 票务系统 SHALL 支持根据日期和价格进行筛选
6. THE 票务系统 SHALL 支持根据热度进行排序
7. THE 票务系统 SHALL 在列表页展示内容包括：展示图片、名称、日期、周几、时间、城市、剧院、价格
8. WHEN 用户点击列表项，THE 票务系统 SHALL 跳转至项目详情页面

---

### 需求 5: 项目详情页

**用户故事:** 作为C端用户，我希望查看演出的详细信息，以便决定是否购票

#### 验收标准

1. THE 票务系统 SHALL 展示项目轮播图
2. THE 票务系统 SHALL 展示项目名称
3. THE 票务系统 SHALL 展示日期、周几、时间
4. THE 票务系统 SHALL 展示城市地点，点击后可进行地图导航
5. THE 票务系统 SHALL 根据项目配置的开关判断是否展示想看人数
6. THE 票务系统 SHALL 展示项目详情图文介绍
7. THE 票务系统 SHALL 展示场次列表选择
8. THE 票务系统 SHALL 展示票档选择
9. THE 票务系统 SHALL 展示购票须知
10. THE 票务系统 SHALL 展示抢票攻略（预选观演人按钮，抢票小贴士：展示预约场次和票档的流程）
11. THE 票务系统 SHALL 提供想看按钮，点击添加到想看列表
12. THE 票务系统 SHALL 提供分享按钮，点击进行分享
13. THE 票务系统 SHALL 提供购票按钮，展示开售倒计时、缺货登记、各类可售状态、预约抢票
14. WHEN 用户点击购票按钮，THE 票务系统 SHALL 跳转到场次票档页
15. IF 项目尚未开售，THEN THE 票务系统 SHALL 提供预约抢票功能，用户可预约开售提醒
16. WHEN 预约的项目开售时，THE 票务系统 SHALL 向用户发送开售提醒通知

---

### 需求 6: 场次票档页

**用户故事:** 作为C端用户，我希望选择演出场次和票档，以便购买符合我需求的门票

#### 验收标准

1. THE 票务系统 SHALL 以平铺模式展示场次列表
2. THE 票务系统 SHALL 展示票档列表，包括价格和库存状态
3. WHEN 票档售罄，THE 票务系统 SHALL 显示售罄状态
4. THE 票务系统 SHALL 提供缺货登记功能
5. WHEN 用户选择完成后，THE 票务系统 SHALL 进入订单确认页

---

### 需求 7: 选座功能说明

**用户故事:** 作为系统设计者，我需要明确系统不包含选座功能

#### 验收标准

1. THE 票务系统 SHALL 不包含手动选座功能
2. THE 票务系统 SHALL 不进行座位分配
3. THE 票务系统 SHALL 支持B端人工录入座位信息
4. WHEN 座位信息录入后，THE 票务系统 SHALL 在C端订单详情和电子票中展示座位信息

---

### 需求 8: 订单确认页

**用户故事:** 作为C端用户，我希望在提交订单前确认所有信息，以便确保购票信息准确

#### 验收标准

1. THE 票务系统 SHALL 展示项目基本信息（名称、城市、场馆、日期、时间、价格、数量等）
2. THE 票务系统 SHALL 展示服务说明（实名制入场说明、退单说明、选座说明、发票说明等）
3. THE 票务系统 SHALL 展示场次票档基本信息
4. THE 票务系统 SHALL 展示观影人信息模块，提供新增按钮
5. WHEN 用户点击新增观影人按钮，THE 票务系统 SHALL 跳转添加观影人页面
6. THE 票务系统 SHALL 提供配送方式选择
7. THE 票务系统 SHALL 提供联系电话填写
8. THE 票务系统 SHALL 提供支付方式选择
9. THE 票务系统 SHALL 展示价格信息（包含实付价格和价格明细）
10. THE 票务系统 SHALL 提供提交订单按钮
11. WHEN 用户点击提交订单按钮，THE 票务系统 SHALL 跳转至支付页面

---

### 需求 9: 订单信息完成页

**用户故事:** 作为C端用户，我希望完成支付并查看订单信息，以便确认购票成功

#### 验收标准

1. WHEN 支付成功或取消后，THE 票务系统 SHALL 跳转至订单信息完成页
2. THE 票务系统 SHALL 展示订单状态
3. THE 票务系统 SHALL 展示服务说明
4. THE 票务系统 SHALL 展示项目基本信息（名称、城市、场馆、日期、时间等）
5. THE 票务系统 SHALL 提供座位图查看功能
6. THE 票务系统 SHALL 展示价格和数量
7. THE 票务系统 SHALL 展示配送方式
8. THE 票务系统 SHALL 展示联系人信息
9. THE 票务系统 SHALL 展示观演人信息
10. THE 票务系统 SHALL 展示订单信息（订单编号、创建时间）
11. IF 订单为未支付状态，THEN THE 票务系统 SHALL 展示付款按钮和取消订单按钮
12. WHEN 支付成功，THE 票务系统 SHALL 给用户发送短信通知

---

### 需求 10: 支付收银台

**用户故事:** 作为C端用户，我希望选择支付方式完成付款

#### 验收标准

1. THE 票务系统 SHALL 支持微信支付
2. THE 票务系统 SHALL 支持支付宝支付

---

### 需求 11: 我的（个人中心）

**用户故事:** 作为C端用户，我希望管理我的账号和订单信息，以便查看和管理我的购票记录

#### 验收标准

1. THE 票务系统 SHALL 提供账号信息管理功能（登录注册、昵称修改、性别修改、生日修改、头像修改）
2. THE 票务系统 SHALL 展示我的订单列表，点击展示订单详情
3. THE 票务系统 SHALL 在订单详情中提供取消订单功能（未支付订单）
4. THE 票务系统 SHALL 在订单详情中提供退票申请功能（已支付订单，根据退票规则判断是否可退）
5. THE 票务系统 SHALL 提供票夹功能，列表展示，点击跳转详情
6. THE 票务系统 SHALL 提供收货地址管理功能
7. THE 票务系统 SHALL 提供观影人管理功能
8. THE 票务系统 SHALL 提供账户实名管理功能（对接实名认证第三方）
9. THE 票务系统 SHALL 提供客服功能（只展示客服电话信息）
10. THE 票务系统 SHALL 提供想看列表功能
11. THE 票务系统 SHALL 提供协议规则展示（包含隐私协议、用户服务协议等）

**用户账号信息字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 手机号 | 文本 | 是 | 用户登录账号，唯一标识 |
| 密码 | 密码 | 是 | 登录密码，加密存储 |
| 昵称 | 文本 | 否 | 用户昵称 |
| 头像 | 图片 | 否 | 用户头像 |
| 性别 | 单选 | 否 | 男/女/保密 |
| 生日 | 日期 | 否 | 用户生日 |

**收货地址字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 收货人姓名 | 文本 | 是 | 收货人姓名 |
| 联系电话 | 文本 | 是 | 收货人电话 |
| 省份 | 下拉选择 | 是 | 省份 |
| 城市 | 下拉选择 | 是 | 城市 |
| 区县 | 下拉选择 | 是 | 区县 |
| 详细地址 | 文本 | 是 | 详细地址 |
| 是否默认 | 开关 | 是 | 是否设为默认地址 |

**观演人信息字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 真实姓名 | 文本 | 是 | 观演人真实姓名 |
| 身份证号 | 文本 | 是 | 身份证号码，加密存储 |
| 手机号 | 文本 | 否 | 观演人联系电话 |
| 是否默认 | 开关 | 是 | 是否设为默认观演人 |

**实名认证信息字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 真实姓名 | 文本 | 是 | 用户真实姓名 |
| 身份证号 | 文本 | 是 | 身份证号码 |
| 认证状态 | 状态 | 系统 | 未认证/认证中/已认证/认证失败 |
| 认证时间 | 日期时间 | 系统 | 认证通过时间 |

---

### 需求 12: C端高并发和安全要求

**用户故事:** 作为系统架构师，我需要确保系统能够支持高并发抢票场景

#### 验收标准

1. THE 票务系统 SHALL 支持高并发抢票场景
2. THE 票务系统 SHALL 实现黑名单检测功能（根据手机号、身份证号识别）
3. WHEN 用户在黑名单中，THE 票务系统 SHALL 阻止该用户进行购票操作

---

## 二、电商B端需求（Vue管理后台）

### 数据实体映射关系说明

```
城市(City) ←──┐
              │
频道(Channel) ←──┐
                 │
场馆(Venue) ←────┼── 项目(Event) ──→ 场次(Session) ──→ 票档(TicketTier)
                 │       │              │                    │
                 │       │              │                    │
                 │       ↓              ↓                    ↓
                 │   售票规则      场馆关联              库存管理
                 │   (SaleRule)   (Venue)              (Stock)
                 │
用户(User) ──→ 订单(Order) ──→ 订单项(OrderItem) ──→ 电子票(Ticket)
    │              │
    │              ↓
    │          观演人(Attendee)
    │
    └──→ 想看列表(Wishlist)
    └──→ 收货地址(Address)
    └──→ 实名信息(RealNameInfo)
```

**核心实体关系：**
- 项目(1) : 场次(N) - 一个项目可以有多个场次
- 场次(1) : 票档(N) - 一个场次可以有多个票档
- 场次(N) : 场馆(1) - 多个场次可以关联同一个场馆
- 项目(N) : 频道(1) - 多个项目可以属于同一个频道
- 用户(1) : 订单(N) - 一个用户可以有多个订单
- 订单(1) : 订单项(N) - 一个订单可以有多个订单项（多张票）


### 需求 13: B端登录

**用户故事:** 作为B端商家，我希望安全登录系统，以便管理我的演出项目

#### 验收标准

1. THE 票务系统 SHALL 支持账号密码登录，账号为手机号
2. THE 票务系统 SHALL 支持手机验证码登录

---

### 需求 14: B端首页看板

**用户故事:** 作为B端商家，我希望在首页查看关键业务数据，以便了解经营状况

#### 验收标准

1. THE 票务系统 SHALL 在B端首页展示票房数据
2. THE 票务系统 SHALL 在B端首页展示项目场次数据
3. THE 票务系统 SHALL 在B端首页展示销售报表（销售额趋势、订单量统计等）

---

### 需求 15: B端项目管理

**用户故事:** 作为B端商家，我希望创建和管理演出项目，以便在平台上售票

#### 验收标准

1. THE 票务系统 SHALL 提供项目列表，支持根据项目名称模糊搜索，有相关操作按钮
2. THE 票务系统 SHALL 提供项目详情页，查看项目详情信息
3. THE 票务系统 SHALL 提供项目新建功能，配置字段包括：

**项目基本信息配置：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 项目名称 | 文本 | 是 | 演出项目的名称 |
| 项目分类 | 下拉选择 | 是 | 关联频道，如演唱会、话剧、体育等 |
| 项目封面图 | 图片上传 | 是 | 列表页展示的封面图 |
| 项目轮播图 | 多图上传 | 否 | 详情页顶部轮播展示 |
| 项目详情介绍 | 富文本 | 是 | 图文混排的详情介绍 |
| 购票须知 | 富文本 | 是 | 购票注意事项说明 |
| 抢票攻略 | 富文本 | 否 | 抢票技巧说明 |
| 演出时长 | 数字 | 否 | 演出时长（分钟） |
| 艺人/演员信息 | 文本 | 否 | 参演艺人或演员 |
| 是否展示想看人数 | 开关 | 是 | 控制C端是否展示想看人数 |
| 项目模板 | 下拉选择 | 否 | 可选择已有模板快速填充 |

**售票规则配置：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 限购数量 | 数字 | 是 | 每人每场次限购票数 |
| 是否可退票 | 开关 | 是 | 是否允许退票 |
| 退票规则配置 | JSON配置 | 否 | 阶梯式退票规则，包含时间段和手续费比例 |
| 开售时间 | 日期时间 | 是 | 票务开始销售时间 |
| 结束时间 | 日期时间 | 否 | 票务停止销售时间 |
| 是否实名购票 | 开关 | 是 | 是否需要实名制购票 |

4. THE 票务系统 SHALL 提供项目编辑功能
5. THE 票务系统 SHALL 提供项目模版管理功能（保存项目配置为模板，方便复用）

6. THE 票务系统 SHALL 提供场次管理功能

**场次配置字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 所属项目 | 下拉选择 | 是 | 关联项目ID（一个场次只属于一个项目） |
| 演出日期 | 日期选择 | 是 | 演出的具体日期 |
| 开始时间 | 时间选择 | 是 | 演出开始时间 |
| 结束时间 | 时间选择 | 否 | 演出结束时间 |
| 关联场馆 | 下拉选择 | 是 | 选择已创建的场馆 |
| 场次状态 | 下拉选择 | 是 | 上架/下架 |

**场次与项目关系：** 一个项目可以有多个场次（1:N），一个场次只能属于一个项目
**入口方式：** 通过项目详情页的"场次管理"按钮进入，或在场次列表中选择项目后添加

7. THE 票务系统 SHALL 提供票档管理功能

**票档配置字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 所属场次 | 下拉选择 | 是 | 关联场次ID（一个票档只属于一个场次） |
| 票档名称 | 文本 | 是 | 如：VIP区、普通区、看台区等 |
| 票档价格 | 数字 | 是 | 单张票价格（元） |
| 总库存数量 | 数字 | 是 | 该票档的总票数 |
| 可售库存 | 数字 | 是 | 当前可售票数（自动计算或手动调整） |
| 票档状态 | 下拉选择 | 是 | 上架/下架/售罄 |

**票档与场次关系：** 一个场次可以有多个票档（1:N），一个票档只能属于一个场次
**入口方式：** 通过场次详情页的"票档管理"按钮进入，或在票档列表中选择场次后添加

8. THE 票务系统 SHALL 提供售票规则管理功能（在项目级别配置，适用于该项目下所有场次）
9. THE 票务系统 SHALL 提供票档库存管理功能（库存调整、库存预警）
10. THE 票务系统 SHALL 提供座位图上传功能

---

### 需求 16: B端后台售票

**用户故事:** 作为B端商家，我希望在后台直接售票，以便处理线下购票需求

#### 验收标准

1. THE 票务系统 SHALL 提供后台售票功能
2. THE 票务系统 SHALL 包含选择项目、场次、票档、库存的完整流程
3. THE 票务系统 SHALL 支持填写购票人信息
4. THE 票务系统 SHALL 支持支付操作
5. THE 票务系统 SHALL 支持电子票生成和发送

**后台售票流程字段：**
| 步骤 | 操作内容 | 说明 |
|------|----------|------|
| 1. 选择项目 | 下拉选择项目 | 从项目列表中选择要售票的项目 |
| 2. 选择场次 | 下拉选择场次 | 根据项目筛选可用场次 |
| 3. 选择票档 | 下拉选择票档 | 根据场次筛选可用票档，显示库存 |
| 4. 选择数量 | 数字输入 | 输入购票数量，不超过库存和限购数 |
| 5. 填写购票人 | 表单填写 | 姓名、手机号、身份证号 |
| 6. 填写座位信息 | 文本输入 | 可选，如：1排5座、A区10排8号 |
| 7. 选择支付方式 | 下拉选择 | 现金/微信/支付宝/免费赠票 |
| 8. 确认售票 | 按钮操作 | 扣减库存，生成订单 |
| 9. 发送电子票 | 自动/手动 | 生成电子票并发送短信 |

**电子票信息字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 电子票码 | 文本 | 系统生成 | 唯一票码，用于核验 |
| 二维码 | 图片 | 系统生成 | 入场扫码用 |
| 订单ID | 关联 | 系统 | 关联订单 |
| 项目名称 | 文本 | 系统 | 演出项目名称 |
| 场次信息 | 文本 | 系统 | 演出日期时间 |
| 场馆信息 | 文本 | 系统 | 场馆名称和地址 |
| 票档名称 | 文本 | 系统 | 票档名称 |
| 座位信息 | 文本 | 可选 | 座位号（如有） |
| 观演人 | 文本 | 系统 | 观演人姓名 |
| 票状态 | 状态 | 系统 | 有效/已使用/已退票/已过期 |

---

### 需求 17: B端订单管理

**用户故事:** 作为B端商家，我希望管理订单和处理退票退款，以便提供良好的售后服务

#### 验收标准

1. THE 票务系统 SHALL 提供订单列表功能
2. THE 票务系统 SHALL 提供订单详情查看功能
3. THE 票务系统 SHALL 提供退票退款管理功能
4. THE 票务系统 SHALL 提供电子票生成与发送功能
5. THE 票务系统 SHALL 提供票夹信息导入导出功能
6. THE 票务系统 SHALL 设定导入和导出模版
7. THE 票务系统 SHALL 支持导出订单相关数据
8. THE 票务系统 SHALL 支持导入数据后更新订单相关数据
9. THE 票务系统 SHALL 支持批量导入座位信息（通过Excel模板）
10. THE 票务系统 SHALL 在订单详情中提供座位信息编辑功能

**订单信息字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 订单编号 | 文本 | 系统生成 | 唯一订单标识 |
| 用户ID | 关联 | 系统 | 关联下单用户 |
| 项目ID | 关联 | 系统 | 关联演出项目 |
| 场次ID | 关联 | 系统 | 关联演出场次 |
| 票档ID | 关联 | 系统 | 关联票档 |
| 购票数量 | 数字 | 是 | 购买票数 |
| 单价 | 数字 | 系统 | 票档单价 |
| 总金额 | 数字 | 系统 | 订单总金额 |
| 实付金额 | 数字 | 系统 | 实际支付金额 |
| 订单状态 | 状态 | 系统 | 待支付/已支付/已取消/已退款/已完成 |
| 支付方式 | 文本 | 是 | 微信/支付宝 |
| 支付时间 | 日期时间 | 系统 | 支付完成时间 |
| 联系人姓名 | 文本 | 是 | 联系人姓名 |
| 联系电话 | 文本 | 是 | 联系人电话 |
| 配送方式 | 下拉选择 | 是 | 电子票/快递 |
| 收货地址 | 文本 | 否 | 快递配送地址 |
| 创建时间 | 日期时间 | 系统 | 订单创建时间 |

**订单项信息字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 订单ID | 关联 | 系统 | 关联订单 |
| 票档ID | 关联 | 系统 | 关联票档 |
| 观演人姓名 | 文本 | 是 | 观演人真实姓名 |
| 观演人身份证 | 文本 | 是 | 观演人身份证号 |
| 票价 | 数字 | 系统 | 单张票价 |
| 座位信息 | 文本 | 否 | 座位号（人工录入，如：1排5座） |
| 电子票码 | 文本 | 系统生成 | 电子票唯一码 |
| 票状态 | 状态 | 系统 | 有效/已使用/已退票 |

**退票退款信息字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 退款单号 | 文本 | 系统生成 | 唯一退款标识 |
| 订单ID | 关联 | 系统 | 关联原订单 |
| 退款金额 | 数字 | 系统计算 | 退款金额（扣除手续费） |
| 手续费 | 数字 | 系统计算 | 退票手续费 |
| 退款原因 | 文本 | 是 | 用户填写退款原因 |
| 退款状态 | 状态 | 系统 | 待审核/已通过/已拒绝/已退款 |
| 审核人 | 关联 | 系统 | 审核操作人 |
| 审核时间 | 日期时间 | 系统 | 审核时间 |
| 退款时间 | 日期时间 | 系统 | 实际退款时间 |

---

### 需求 18: B端场馆管理

**用户故事:** 作为B端商家，我希望管理场馆信息

#### 验收标准

1. THE 票务系统 SHALL 提供场馆列表功能（增删改查）
2. THE 票务系统 SHALL 提供场馆详情查看功能

**场馆配置字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 场馆名称 | 文本 | 是 | 场馆的名称 |
| 所在城市 | 下拉选择 | 是 | 关联城市 |
| 详细地址 | 文本 | 是 | 场馆的详细地址 |
| 经度 | 数字 | 否 | 用于地图定位 |
| 纬度 | 数字 | 否 | 用于地图定位 |
| 场馆容量 | 数字 | 否 | 场馆可容纳人数 |
| 场馆图片 | 图片上传 | 否 | 场馆外观或内部图片 |
| 场馆状态 | 下拉选择 | 是 | 启用/禁用 |

**场馆与场次关系：** 一个场馆可以被多个场次关联（1:N），场次创建时选择场馆

---

### 需求 19: B端运营工具管理

**用户故事:** 作为B端商家，我希望管理运营相关配置

#### 验收标准

1. THE 票务系统 SHALL 提供城市管理功能（城市列表展示、增删改查功能）
2. THE 票务系统 SHALL 支持配置城市的热门状态和排序权重
3. THE 票务系统 SHALL 支持启用或禁用城市
4. THE 票务系统 SHALL 提供频道（金刚位）管理功能（频道列表展示、增删改查功能）
5. THE 票务系统 SHALL 支持配置频道图标、排序权重
6. THE 票务系统 SHALL 支持启用或禁用频道
7. THE 票务系统 SHALL 提供Banner管理功能，用于C端轮播图展示使用
8. THE 票务系统 SHALL 提供黑名单管理功能，用于C端进行黑名单用户拦截
9. THE 票务系统 SHALL 支持配置手机号黑名单
10. THE 票务系统 SHALL 支持配置身份证号黑名单
11. THE 票务系统 SHALL 提供技术参数管理功能（枚举、开关等配置管理）

**城市配置字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 城市名称 | 文本 | 是 | 城市名称 |
| 城市编码 | 文本 | 是 | 城市唯一编码 |
| 首字母 | 文本 | 是 | 城市名称首字母，用于快速定位 |
| 是否热门 | 开关 | 是 | 是否为热门城市 |
| 排序权重 | 数字 | 是 | 热门城市排序，数字越大越靠前 |
| 状态 | 下拉选择 | 是 | 启用/禁用 |
| 创建时间 | 日期时间 | 系统 | 创建时间 |
| 更新时间 | 日期时间 | 系统 | 最后更新时间 |

**频道（金刚位）配置字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 频道名称 | 文本 | 是 | 频道显示名称，如演唱会、话剧等 |
| 频道编码 | 文本 | 是 | 频道唯一编码 |
| 频道图标 | 图片上传 | 是 | 金刚位展示图标 |
| 排序权重 | 数字 | 是 | 显示顺序，数字越大越靠前 |
| 状态 | 下拉选择 | 是 | 启用/禁用 |
| 创建时间 | 日期时间 | 系统 | 创建时间 |
| 更新时间 | 日期时间 | 系统 | 最后更新时间 |

**Banner配置字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| Banner名称 | 文本 | 是 | Banner标识名称 |
| Banner图片 | 图片上传 | 是 | 轮播图片 |
| 跳转类型 | 下拉选择 | 是 | 项目详情/外部链接/无跳转 |
| 跳转目标 | 文本 | 否 | 项目ID或外部URL |
| 展示城市 | 多选 | 否 | 在哪些城市展示，不选择表示全部城市 |
| 排序权重 | 数字 | 是 | 数字越大越靠前 |
| 开始时间 | 日期时间 | 是 | Banner生效时间 |
| 结束时间 | 日期时间 | 是 | Banner失效时间 |
| 状态 | 下拉选择 | 是 | 启用/禁用 |

**黑名单配置字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 黑名单类型 | 下拉选择 | 是 | 手机号/身份证号 |
| 黑名单值 | 文本 | 是 | 手机号或身份证号 |
| 拉黑原因 | 文本 | 是 | 拉黑原因说明 |
| 操作人 | 关联 | 系统 | 添加黑名单的操作人 |
| 添加时间 | 日期时间 | 系统 | 添加时间 |
| 状态 | 下拉选择 | 是 | 生效/已解除 |

**技术参数配置字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 参数编码 | 文本 | 是 | 参数唯一标识 |
| 参数名称 | 文本 | 是 | 参数显示名称 |
| 参数类型 | 下拉选择 | 是 | text/number/boolean/enum |
| 参数值 | 文本/JSON | 是 | 参数当前值，枚举类型为JSON格式 |
| 参数说明 | 文本 | 否 | 参数用途说明 |
| 是否可编辑 | 开关 | 是 | 是否允许修改 |

**参数类型说明：**
- **text**: 文本类型，直接输入文本
- **number**: 数字类型，输入数字
- **boolean**: 布尔类型，开关控件
- **enum**: 枚举类型，下拉选择，值格式为：`{"current":"value","options":[{"value":"v1","label":"显示名"}]}`

---

### 需求 20: B端账号及权限管理

**用户故事:** 作为系统管理员，我希望管理系统账号和权限

#### 验收标准

1. THE 票务系统 SHALL 初始化一个admin系统管理员账号，拥有最高权限
2. THE 票务系统 SHALL 提供账号管理功能（账号列表展示、增删改查功能）
3. THE 票务系统 SHALL 提供角色管理功能
4. THE 票务系统 SHALL 提供账号角色管理功能
5. THE 票务系统 SHALL 提供角色权限管理功能（包含菜单权限控制和按钮权限控制）

**账号信息字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 账号（手机号） | 文本 | 是 | 登录账号，唯一标识 |
| 密码 | 密码 | 是 | 登录密码，加密存储 |
| 姓名 | 文本 | 是 | 用户真实姓名 |
| 所属角色 | 多选 | 是 | 关联角色（一个账号可有多个角色） |
| 账号状态 | 下拉选择 | 是 | 启用/禁用 |
| 最后登录时间 | 日期时间 | 系统 | 最后一次登录时间 |
| 最后登录IP | 文本 | 系统 | 最后一次登录IP |
| 创建时间 | 日期时间 | 系统 | 账号创建时间 |

**角色信息字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 角色编码 | 文本 | 是 | 角色唯一标识 |
| 角色名称 | 文本 | 是 | 角色显示名称 |
| 角色描述 | 文本 | 否 | 角色说明 |
| 角色状态 | 下拉选择 | 是 | 启用/禁用 |
| 创建时间 | 日期时间 | 系统 | 角色创建时间 |

**权限信息字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 权限编码 | 文本 | 是 | 权限唯一标识 |
| 权限名称 | 文本 | 是 | 权限显示名称 |
| 权限类型 | 下拉选择 | 是 | 菜单/按钮 |
| 父级权限 | 下拉选择 | 否 | 上级权限（用于构建权限树） |
| 排序 | 数字 | 是 | 显示顺序 |

**角色权限关联：**
- 一个角色可以拥有多个权限（N:N关系）
- 一个账号可以拥有多个角色（N:N关系）
- 账号的最终权限 = 所有角色权限的并集

---

### 需求 21: B端操作日志管理

**用户故事:** 作为系统管理员，我希望查看系统操作日志，以便追踪用户操作和排查问题

#### 验收标准

1. THE 票务系统 SHALL 记录所有关键业务操作日志（登录、项目管理、订单操作、权限变更等）
2. THE 票务系统 SHALL 提供操作日志列表查询功能，支持按时间、操作类型、操作人筛选
3. THE 票务系统 SHALL 在日志中记录操作人、操作时间、操作类型、操作内容、IP地址等信息
4. THE 票务系统 SHALL 提供日志详情查看功能
5. THE 票务系统 SHALL 支持日志导出功能

**操作日志字段：**
| 字段名 | 字段类型 | 是否必填 | 说明 |
|--------|----------|----------|------|
| 日志ID | 文本 | 系统生成 | 日志唯一标识 |
| 操作人ID | 关联 | 系统 | 执行操作的账号 |
| 操作人姓名 | 文本 | 系统 | 操作人姓名 |
| 操作类型 | 下拉选择 | 系统 | 登录/新增/编辑/删除/导出/审核等 |
| 操作模块 | 文本 | 系统 | 项目管理/订单管理/用户管理等 |
| 操作内容 | 文本 | 系统 | 具体操作描述 |
| 操作数据 | JSON | 系统 | 操作前后数据对比（可选） |
| 操作IP | 文本 | 系统 | 操作时的IP地址 |
| 操作时间 | 日期时间 | 系统 | 操作发生时间 |
| 操作结果 | 下拉选择 | 系统 | 成功/失败 |
| 失败原因 | 文本 | 系统 | 操作失败时的原因 |

---

## 三、技术要求

### 需求 22: 技术栈要求

**用户故事:** 作为技术负责人，我需要明确系统的技术栈要求

#### 验收标准

1. THE C端前端 SHALL 使用uni-app框架开发，支持Android和iOS移动端发布
2. THE B端前端 SHALL 使用Vue框架开发
3. THE 后端 SHALL 使用Java实现
4. THE 后端 SHALL 使用Maven项目管理
5. THE 后端 SHALL 使用JDK版本17或更高版本

---

**文档版本**: v3.0  
**编制日期**: 2025-11-27  
**编制人**: Kiro AI Assistant  
**审核状态**: 待审核
